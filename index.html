<!DOCTYPE html>
<html lang="id">
<head>
  <link rel="icon" href="https://raw.githubusercontent.com/abdulll-bit/urbandrivestore/refs/heads/main/favicon.png" type="image/png">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UrbanDriveStore — Beli Robux & Gamepass CDID Aman & Cepat</title>
  <meta name="description" content="UrbanDriveStore - beli Robux & Gamepass CDID. Marketplace prototype: katalog, keranjang, filter, checkout via WhatsApp." />
  <meta property="og:title" content="UrbanDriveStore — Beli Robux & Gamepass CDID" />
  <meta property="og:description" content="Promo harian, pengiriman cepat, panduan Gamepass. Checkout via WhatsApp." />
  <meta property="og:image" content="/assets/uds-og.png" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#070707;--card:#121212;--muted:#9aa0a6;--accent:#ffcc00;--accent-2:#ff8a00;--glass: rgba(255,255,255,0.03);--success:#22c55e}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Montserrat',sans-serif;background:linear-gradient(180deg,var(--bg),#050505);color:#fff}
    a{color:inherit}
    header{position:sticky;top:0;z-index:40;background:linear-gradient(90deg,#0b0b0b, rgba(255,204,0,0.03));backdrop-filter: blur(4px);border-bottom:1px solid rgba(255,255,255,0.03)}
    .container{max-width:1200px;margin:0 auto;padding:18px}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{height:44px;width:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#000;font-weight:700}
    .brand h1{font-size:18px;margin:0;color:var(--accent);letter-spacing:0.4px}
    .search{flex:1;margin-left:18px}
    .search input{width:100%;padding:10px 14px;border-radius:10px;border:none;background:var(--glass);color:#fff}
    .actions{display:flex;align-items:center;gap:10px}
    .icon-btn{background:var(--card);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}

    /* HERO */
    .hero{padding:36px 0;background:linear-gradient(180deg,rgba(255,204,0,0.02),transparent)}
    .hero-grid{display:grid;grid-template-columns:1fr 360px;gap:24px;align-items:center}
    .hero-title{font-size:28px;margin-bottom:10px;color:var(--accent)}
    .hero-sub{color:var(--muted);margin-bottom:18px}
    .cta-row{display:flex;gap:12px}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:12px 16px;border-radius:10px;color:#000;font-weight:700;border:none;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px;border-radius:10px;color:var(--muted);cursor:pointer}

    .stats{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
    .stat{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:10px;min-width:110px;text-align:center}
    .stat strong{display:block;color:var(--accent);font-size:18px}
    .stat small{color:var(--muted)}

    /* LAYOUT */
    main{padding:14px 0 80px}
    .main-grid{display:grid;grid-template-columns:260px 1fr;gap:20px}

    /* SIDEBAR */
    .sidebar{position:sticky;top:86px;background:var(--card);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .filters h3{margin:0 0 10px 0;color:var(--accent)}
    .category-list{display:flex;flex-direction:column;gap:8px}
    .category{padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.02);cursor:pointer}
    .category.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#000;font-weight:600}
    .range{margin-top:12px}

    /* PRODUCTS */
    .catalog{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .product{background:var(--card);border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column}
    .product .thumb{height:140px;background-size:cover;background-position:center}
    .product .body{padding:12px;flex:1;display:flex;flex-direction:column}
    .product h4{margin:0 0 6px 0;color:var(--accent);font-size:15px}
    .product p{margin:0 0 8px 0;color:var(--muted);font-size:13px}
    .price-row{display:flex;justify-content:space-between;align-items:center;margin-top:auto}
    .price{font-weight:700}
    .add{background:var(--accent);padding:8px 10px;border-radius:8px;color:#000;border:none;cursor:pointer}

    /* CART */
    .cart-bar{position:fixed;right:18px;bottom:18px;background:linear-gradient(90deg,var(--accent),var(--accent-2));padding:12px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.5);z-index:100}
    .cart-count{background:#000;color:var(--accent);padding:6px 8px;border-radius:8px;font-weight:700;margin-left:8px}

    /* CART SIDEBAR */
    .cart-sidebar{position:fixed;right:18px;top:86px;width:300px;max-height:72vh;background:#0e0e0e;border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03);overflow:auto;box-shadow:0 10px 30px rgba(0,0,0,0.6);display:none;z-index:120}
    .cart-item{display:flex;gap:10px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.03)}
    .cart-item img{width:64px;height:48px;object-fit:cover;border-radius:8px}
    .cart-actions{display:flex;gap:8px;align-items:center;margin-top:12px}
    .checkout-btn{flex:1;background:var(--accent);border:none;padding:10px;border-radius:8px;color:#000;font-weight:700;cursor:pointer}
    .clear-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}

    /* MODAL */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:200}
    .modal{background:#121212;padding:20px;border-radius:12px;max-width:720px;width:95%;max-height:86vh;overflow:auto}
    .modal .row{display:flex;gap:16px}
    .modal .thumb{flex:0 0 260px;height:180px;background-size:cover;border-radius:10px}
    .modal .info{flex:1}
    .modal h3{margin-top:0;color:var(--accent)}

    /* MOBILE FILTER */
    .mobile-filter-btn{display:none;position:fixed;left:18px;bottom:18px;z-index:110;background:var(--card);border-radius:12px;padding:10px;border:1px solid rgba(255,255,255,0.03)}
    .filter-drawer{position:fixed;left:0;right:0;bottom:0;background:#0e0e0e;padding:16px;border-radius:12px 12px 0 0;display:none;z-index:210}

    /* FOOTER */
    footer{padding:36px 0;margin-top:30px;color:var(--muted);text-align:center}


    /* Instagram Stories Section Styles */
    .instagram-stories-section {
      margin-top: 28px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      padding: 16px;
      border-radius: 12px;
    }
    .instagram-stories-section h3 {
      margin: 0 0 8px 0;
      color: var(--accent);
    }
    .stories-container {
      display: flex;
      gap: 12px;
      overflow-x: auto; /* Allow horizontal scrolling */
      padding-bottom: 10px; /* Space for scrollbar */
      -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
      scrollbar-width: thin; /* Firefox */
      scrollbar-color: var(--accent) transparent; /* Firefox */
    }
    .stories-container::-webkit-scrollbar {
      height: 6px;
    }
    .stories-container::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
    }
    .stories-container::-webkit-scrollbar-thumb {
      background-color: var(--accent);
      border-radius: 10px;
      border: 1px solid var(--card);
    }
    .story-item {
      flex: 0 0 auto; /* Prevent shrinking */
      width: 80px; /* Fixed width for each story circle */
      text-align: center;
      text-decoration: none;
      color: inherit;
    }
    .story-circle {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); /* Instagram gradient */
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 5px;
      padding: 3px; /* Border thickness */
      box-sizing: border-box;
    }
    .story-thumbnail {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--card); /* Inner border */
    }
    .story-label {
      font-size: 0.75rem;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }


.checkout-modal {
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:200;
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn {
  from {opacity:0;}
  to {opacity:1;}
}
.checkout-content {
  background:#fff; color:#000; padding:25px; border-radius:12px; width:90%; max-width:420px;
  box-shadow:0 6px 20px rgba(0,0,0,0.4); transform: translateY(-30px); opacity:0;
  animation: slideUp 0.4s ease forwards;
}
@keyframes slideUp {
  to {transform: translateY(0); opacity:1;}
}
.checkout-content h2 { margin-bottom:20px; text-align:center; font-size:1.4rem; color:#333; }
.checkout-content label { display:block; margin-top:12px; font-weight:600; font-size:0.9rem; color:#444; }
.checkout-content input, .checkout-content select, .checkout-content textarea {
  width:100%; padding:10px; margin-top:5px; border-radius:8px; border:1px solid #ccc; font-size:14px;
  transition:border-color 0.2s ease, box-shadow 0.2s ease;
}
.checkout-content input:focus, .checkout-content select:focus, .checkout-content textarea:focus {
  border-color:#ffcc00; box-shadow:0 0 4px rgba(255,204,0,0.6); outline:none;
}
.checkout-content textarea { resize:vertical; min-height:70px; }
.checkout-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:20px; }
.checkout-actions button {
  padding:9px 16px; border:none; border-radius:8px; cursor:pointer; font-weight:600; font-size:0.9rem;
  transition: background 0.2s ease, transform 0.2s ease;
}
.checkout-actions button:hover { transform: translateY(-1px); }
#checkoutCancel { background:#ccc; color:#333; }
#checkoutCancel:hover { background:#bbb; }
#checkoutSubmit { background:#ffcc00; color:#000; }
#checkoutSubmit:hover { background:#e6b800; }
.error-msg { color:red; font-size:0.8rem; margin-top:4px; display:none; }

#checkoutCancel { background:#ccc; }
#checkoutSubmit { background:#ffcc00; }


/* === Responsive Styles === */
@media (max-width: 768px) {
  .nav {
    flex-wrap: wrap;
    gap: 8px;
  }
  .search {
    order: 3;
    width: 100%;
    margin-left: 0;
  }
  .hero-grid {
    grid-template-columns: 1fr;
  }
  .main-grid {
    grid-template-columns: 1fr;
  }
  .sidebar {
    display: none;
  }
  .catalog {
    grid-template-columns: repeat(auto-fill,minmax(160px,1fr));
  }
  .modal .row {
    flex-direction: column;
  }
  .modal .thumb {
    width: 100%;
    height: 200px;
  }
  .checkout-content {
    width: 95%;
    padding: 15px;
  }
}

@media (max-width: 480px) {
  .brand h1 {
    font-size: 16px;
  }
  .btn-primary, .btn-ghost {
    padding: 10px 12px;
    font-size: 14px;
  }
  .product h4 {
    font-size: 14px;
  }
  .product p {
    font-size: 12px;
  }
  .price {
    font-size: 14px;
  }
}

</style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo" aria-hidden="true">UD</div>
        <div>
          <h1>UrbanDriveStore</h1>
          <div style="font-size:12px;color:var(--muted)">Robux & Gamepass CDID — Aman & Cepat</div>
        </div>
      </div>

      <div class="search">
        <input id="searchInput" aria-label="Cari produk" placeholder="Cari produk, misal: Robux, Luxury Car, 50 Robux..." />
      </div>

      <div class="actions">
        <button class="icon-btn" id="btnCartSmall" title="Keranjang" aria-label="Buka keranjang">🛒 <span id="cartBadge" style="margin-left:6px;color:var(--accent)">0</span></button>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="container hero-grid">
      <div>
        <div class="hero-title">Lebih Cepat, Lebih Aman — Dapatkan Robux & Gamepass CDID</div>
        <div class="hero-sub">🚀 Robux dan Gamepass langsung mendarat! Kami utamakan kecepatan, keamanan, dan kenyamanan. Harga sedikit mahal? Itu untuk memastikan bahwa anda layak untuk mendapatkan pelayanan terbaik dan bebas dari risiko penipuan.</div>
        <div class="cta-row">
          <button class="btn-primary" id="btnShopNow">Mulai Belanja</button>
          <button class="btn-ghost" id="btnHow" aria-haspopup="dialog">Cara Order</button>
        </div>

        <div class="stats">
          <div class="stat"><strong>30+</strong><small>Transaksi</small></div>
          <div class="stat"><strong>4.2 ★</strong><small>Rating Customer</small></div>
          <div class="stat"><strong>24/7</strong><small>Support</small></div>
        </div>
      </div>

      <div style="background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)">
  <div style="color:var(--accent);font-weight:700;margin-bottom:8px">
    Tutorial Membuat Gamepass
  </div>
  
  <!-- Video Responsif -->
  <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:8px">
    <iframe 
      src="https://www.youtube.com/embed/2raxL-VgRWM" 
      style="position:absolute;top:0;left:0;width:100%;height:100%;border:none" 
      allowfullscreen>
    </iframe>
  </div>
  
  <!-- Deskripsi Singkat -->
  <div style="margin-top:8px;color:var(--muted);font-size:13px;line-height:1.4">
    Panduan membuat Gamepass di Roblox. Tonton video di atas sebelum melakukan pembelian dan pastikan anda matikan regional pricing.
  </div>
</div>

    </div>
  </section>

  <main class="container">
    <div class="main-grid">
      <aside class="sidebar" id="sidebar">
        <div class="filters">
          <h3>Filter</h3>
          <div style="margin-bottom:8px;color:var(--muted);font-size:13px">Kategori</div>
          <div class="category-list" id="categoryList"></div>

          <div class="range">
            <div style="margin-top:12px;color:var(--muted);font-size:13px">Harga (maks)</div>
            <input type="range" id="priceRange" min="0" max="150000" step="1000" value="150000" />
            <div style="font-size:13px;color:var(--muted);margin-top:6px">Rp <span id="priceRangeVal">150000</span></div>
          </div>
        </div>

        <div style="margin-top:18px">
          <h3>Informasi Penting</h3>
          <ul style="color:var(--muted);font-size:13px">
            <li>Buat Gamepass terlebih dahulu jika tidak tahu cara membuatnya anda bisa menonton video tutorialnya terlebih dahulu dan pastikan anda matikan regional price agar bisa melanjutkan transaksi.</li>
            <li>Gunakan metode pembayaran QRIS jika anda memang membutuhkan produk tersebut secepatnya.</li>
            <li>Chat Admin jika ada kendala seperti proses checkout, pemilihan produk dll.</li>
            <li>Jika robux tidak masuk dalam waktu 5-6 hari (belum pending), bisa laporkan ke Admin beserta bukti transaksinya</li>
            <li>Kami memberikan garansi untuk setiap pembelian robux pending</li>
          </ul>
        </div>
      </aside>

      <section>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div style="color:var(--muted);font-size:14px">Menampilkan <span id="productCount">0</span> produk</div>
          <div style="display:flex;gap:8px;align-items:center">
            <select id="sortSelect" style="background:var(--card);border-radius:8px;padding:8px;border:1px solid rgba(255,255,255,0.03);color:var(--muted)">
              <option value="relevance">Terbaru</option>
              <option value="price_asc">Harga terendah</option>
              <option value="price_desc">Harga tertinggi</option>
            </select>
          </div>
        </div>

        <div class="catalog" id="catalog" aria-live="polite"></div>

        <!-- Bagian Instagram Stories Baru -->
        <div class="instagram-stories-section" id="instagramStories">
          <h3 style="margin:0 0 8px 0;color:var(--accent)">Testimoni Pembelian Produk</h3>
          <div class="stories-container">
            <!-- Testimoni Gamepass -->
            <a href="https://www.instagram.com/stories/highlights/18008607845443918/" target="_blank" class="story-item">
              <div class="story-circle">
                <!-- Ganti src dengan gambar thumbnail yang relevan, atau biarkan placeholder -->
                <img src="https://instagram.fbdo12-1.fna.fbcdn.net/v/t51.29350-15/460730177_1065621008431861_774089344695935907_n.webp?stp=c0.420.1080.1080a_dst-jpg_e35_s150x150_tt6&_nc_ht=instagram.fbdo12-1.fna.fbcdn.net&_nc_cat=101&_nc_oc=Q6cZ2QHtJhHEyTeL0nxBOJxS6RRqv9N97mXi_yyjKamcPXDsa5ydh2uMT5GbjlU-nyAmHIY&_nc_ohc=BJBEi1jV9SEQ7kNvwFrPvW0&_nc_gid=7ToY9xgB9DkuJtwL7W_h4A&edm=AGXveE0BAAAA&ccb=7-5&oh=00_AfWA2_yqzWbqXpQvZJijMxvtV3stXnBXyNTp7_tHoygR9A&oe=68A0943B&_nc_sid=522435" alt="Testimoni Gamepass" class="story-thumbnail">
              </div>
              <div class="story-label">Testimoni Gamepass</div>
            </a>
            <!-- Testimoni Robux -->
            <a href="https://www.instagram.com/stories/highlights/17970470933688363/" target="_blank" class="story-item">
              <div class="story-circle">
                <!-- Ganti src dengan gambar thumbnail yang relevan, atau biarkan placeholder -->
                <img src="https://instagram.fbdo12-1.fna.fbcdn.net/v/t51.29350-15/470902882_900332028562256_5768696218952025430_n.webp?stp=c0.420.1080.1080a_dst-jpg_e35_s150x150_tt6&_nc_ht=instagram.fbdo12-1.fna.fbcdn.net&_nc_cat=108&_nc_oc=Q6cZ2QHtJhHEyTeL0nxBOJxS6RRqv9N97mXi_yyjKamcPXDsa5ydh2uMT5GbjlU-nyAmHIY&_nc_ohc=n7own9ctAgMQ7kNvwEy5fq-&_nc_gid=7ToY9xgB9DkuJtwL7W_h4A&edm=AGXveE0BAAAA&ccb=7-5&oh=00_AfWEqOKucEUgE8PR6-fNMbemd1Clugqiz9dsiuMrMj8nvA&oe=68A0B4B8&_nc_sid=522435" alt="Testimoni Robux" class="story-thumbnail">
              </div>
              <div class="story-label">Testimoni Robux</div>
            </a>
          </div>
        </div>
        <!-- Akhir Bagian Instagram Stories Baru -->

      </section>
    </div>
  </main>

  <button class="mobile-filter-btn icon-btn" id="openFilter" aria-haspopup="dialog">Filter</button>
  <div class="filter-drawer" id="filterDrawer" role="dialog" aria-modal="true" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <strong style="color:var(--accent)">Filter</strong>
      <button class="icon-btn" id="closeFilter">✕</button>
    </div>
    <div style="color:var(--muted);margin-bottom:8px">Kategori</div>
    <div id="mobileCategoryList"></div>
    <div style="margin-top:12px;color:var(--muted);font-size:13px">Harga (maks)</div>
    <input type="range" id="priceRangeMobile" min="0" max="100000" step="1000" value="100000" />
    <div style="font-size:13px;color:var(--muted);margin-top:6px">Rp <span id="priceRangeValMobile">100000</span></div>
    <div style="margin-top:12px;display:flex;gap:8px"><button class="btn-primary" id="applyFilterMobile">Terapkan</button><button class="btn-ghost" id="resetFilterMobile">Reset</button></div>
  </div>

  <div class="cart-bar" id="cartBar" role="button" aria-label="Buka keranjang">
    <div style="display:flex;align-items:center;gap:10px">
      <div style="font-weight:700">Keranjang</div>
      <div class="cart-count" id="cartCount">0</div>
    </div>
  </div>

  <aside class="cart-sidebar" id="cartSidebar" aria-hidden="true">
    <h3 style="margin-top:0;color:var(--accent)">Keranjang Anda</h3>
    <div id="cartItems"></div>
    <div style="margin-top:12px;display:flex;align-items:center;justify-content:space-between">
      <div style="color:var(--muted)">Total</div>
      <div style="font-weight:700" id="cartTotal">Rp0</div>
    </div>
    <div class="cart-actions">
      <!-- Tombol checkout ini akan membuka modal checkout baru -->
      <button class="checkout-btn" id="btnCheckout">Checkout via WhatsApp</button>
      <button class="clear-btn" id="btnClearCart">Kosongkan</button>
    </div>
  </aside>

  <!-- Modal product detail -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3 id="modalTitle">Produk</h3>
        <button class="icon-btn" id="closeModal">✕</button>
      </div>
      <div class="row">
        <div class="thumb" id="modalThumb" role="img" aria-label="Gambar produk"></div>
        <div class="info">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div>
              <h3 id="modalName"></h3>
              <div id="modalCategory" style="color:var(--muted);font-size:13px"></div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:700" id="modalPrice">Rp0</div>
              <div style="font-size:12px;color:var(--muted)">belum termasuk biaya admin</div>
            </div>
          </div>

          <p id="modalDesc" style="color:var(--muted);margin-top:12px"></p>

          <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
            <label for="modalQuantity" style="font-size:13px;color:var(--muted)">Jumlah</label>
            <input id="modalQuantity" type="number" min="1" value="1" style="width:80px;padding:8px;border-radius:8px;border:none;background:#2a2a2a;color:#fff" />
            <button class="add" id="modalAdd">Tambah ke Keranjang</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <div style="display:flex;justify-content:space-between;gap:12px;align-items:center;flex-wrap:wrap">
        <div>
          <div style="color:var(--accent);font-weight:700">UrbanDriveStore</div>
          <div style="color:var(--muted);font-size:13px">Admin: 0821-1574-9457 (WhatsApp)</div>
        </div>
        <div style="color:var(--muted);font-size:13px">© 2025 UrbanDriveStore. All rights reserved.</div>
      </div>
    </div>
  </footer>


<!-- Checkout Modal -->
<div id="checkoutModal" class="checkout-modal">
  <div class="checkout-content">
    <h2>Form Checkout</h2>
    <label for="checkoutUsername">Username Roblox <span style="color:red">*</span></label>
    <input type="text" id="checkoutUsername" placeholder="Masukkan username Roblox" required>
    <span class='error-msg' id='errUsername'>Harap isi Username Roblox</span>

    <label for="checkoutPhone">Nomor WhatsApp <span style="color:red">*</span></label>
    <input type="tel" id="checkoutPhone" placeholder="08xxxxxxxxxx" required>
    <span class='error-msg' id='errPhone'>Harap isi Nomor WhatsApp</span>

    <label for="checkoutPayment">Metode Pembayaran <span style="color:red">*</span></label>
    <select id="checkoutPayment" required>
      <option value="">-- Pilih Metode Pembayaran --</option>
      <option value="Dana">Dana</option>
      <option value="OVO">OVO</option>
      <option value="GoPay">GoPay</option>
      <option value="QRIS">QRIS</option>
           <option value="Mandiri">Mandiri</option>
    </select>
    <span class='error-msg' id='errPayment'>Harap pilih metode pembayaran</span>

    <label for="checkoutNote">Catatan</label>
    <textarea id="checkoutNote" placeholder="Catatan tambahan (opsional)"></textarea>

    <div class="checkout-actions">
        <div id="checkoutTotals" style="margin-top:15px; font-size:0.9rem; background:#f9f9f9; padding:10px; border-radius:8px;">
            <div>Subtotal: <span id="subtotalDisplay">Rp0</span></div>
            <div>Biaya Admin: <span id="adminFeeDisplay">Rp0</span></div>
            <div><strong>Total: <span id="totalDisplay">Rp0</span></strong></div>
        </div>

      <button id="checkoutCancel">Batal</button>
      <button id="checkoutSubmit">Kirim</button>
    </div>
  </div>
</div>

<script>
(function(){
  const PRODUCTS = [
   {id:1,name:'Luxury Car',price:34500,category:'Car Driving Indonesia',img:'https://tr.rbxcdn.com/180DAY-415d1c20afc198d8533caab177ededd1/150/150/Image/Webp/noFilter',alt:'Luxury Car',desc:'Opulent, exotic, and premium. This pass unlocks all the luxury cars of the game. Drive around exclusive luxury cars in the game!'},
{id:2,name:'Rare Imports',price:25500,category:'Car Driving Indonesia',img:'https://tr.rbxcdn.com/180DAY-90221a5fb721a3dbcb06a63195c2dae0/150/150/Image/Webp/noFilter',alt:'Rare Imports',desc:'Own rare gems of CDID with the Rare Imports Gamepass.'},
{id:3,name:'Retro Car',price:22500,category:'Car Driving Indonesia',img:'https://tr.rbxcdn.com/180DAY-ebad1a5562847ef0c7c149c33e2538f8/150/150/Image/Webp/noFilter',alt:'Retro Car',desc:'Experience wide range of cars of the past! From the nimble 70s hot hatch to the rocket saloon of the end of the ###### #### #### unlocks all the retro cars in the game.'},
{id:4,name:'Emergency Vehicle',price:19000,category:'Car Driving Indonesia',img:'https://tr.rbxcdn.com/180DAY-bcfb291fa7cb95688a5ad5bd58d0558e/150/150/Image/Webp/noFilter',alt:'Emergency Vehicle',desc:'Unlocks All Emergency Vehicles.'},
{id:5,name:'Additional Ownable Car',price:13500,category:'Car Driving Indonesia',img:'https://tr.rbxcdn.com/180DAY-af917a5bb5a5b74a5bd3e9a578b39de2/150/150/Image/Webp/noFilter',alt:'Additional car slot',desc:'Adds 28 car slots.'},
{id:6,name:'2x Additional Ownable Car',price:35500,category:'Car Driving Indonesia',img:'https://tr.rbxcdn.com/180DAY-b7d914250a4a7f504fe2f582a52bfd9d/150/150/Image/Webp/noFilter',alt:'2 additional car slots',desc:'Added More Storage to your ownable Cars'},
{id:7,name:'Paycheck Booster (2x)',price:52500,category:'Car Driving Indonesia',img:'https://tr.rbxcdn.com/180DAY-a1f2f58525ddfd91eba4b260a75cf11e/150/150/Image/Webp/noFilter',alt:'Double Paycheck',desc:'Doubles the paycheck by two times.'},
{id:8,name:'+50% Job Earning',price:52500,category:'Car Driving Indonesia',img:'https://tr.rbxcdn.com/180DAY-579bf928493630f26b3c3c21df1a49dc/150/150/Image/Webp/noFilter',alt:'+50% Job Earning',desc:'add 50% of job salary.'},
{id:9,name:'Luxury House',price:11000,category:'Car Driving Indonesia',img:'https://tr.rbxcdn.com/180DAY-0b0ea29403b2b63365ef753893140bcb/150/150/Image/Webp/noFilter',alt:'Luxury House',desc:'Unlocks CDID Luxury Living.'},
{id:10,name:'Advanced Modification',price:33500,category:'Car Driving Indonesia',img:'https://tr.rbxcdn.com/180DAY-5949172a173452eacd953070710f37c6/150/150/Image/Webp/noFilter',alt:'Advanced Modification',desc:'Unlock more modification options to Modify your car to the next level!: Custom color, Custom plate, Delete limiter, Air suspension, and more to come.'}
  ,
  {id:11,name:'50 Robux',price:6500,category:'Robux',desc:'Pembelian 50 Robux.',img:'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
{id:12,name:'100 Robux',price:13000,category:'Robux',desc:'Pembelian 100 Robux.',img:'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
{id:13,name:'200 Robux',price:27000,category:'Robux',desc:'Pembelian 200 Robux.',img:'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
{id:14,name:'300 Robux',price:40000,category:'Robux',desc:'Pembelian 300 Robux.',img:'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
{id:15,name:'400 Robux',price:53000,category:'Robux',desc:'Pembelian 400 Robux.',img:'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
{id:16,name:'500 Robux',price:67000,category:'Robux',desc:'Pembelian 500 Robux.',img:'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
{id:17,name:'600 Robux',price:80000,category:'Robux',desc:'Pembelian 600 Robux.',img:'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
{id:18,name:'700 Robux',price:93000,category:'Robux',desc:'Pembelian 700 Robux.',img:'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'},
{id:19,name:'800 Robux',price:106000,category:'Robux',desc:'Pembelian 800 Robux.',img:'https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg'}
,
{id:20,name:'Emergency Response Cars',price:11500,category:'Driving Experience Japan',desc:'This Gamepass will give you access to buy Emergency Cars such as Ambulance, Firetruck, and Police.',img:'https://tr.rbxcdn.com/180DAY-a00949f3b36fdbc94cade0c47735ea97/150/150/Image/Webp/noFilter'},
{id:21,name:'Advanced Modification',price:12500,category:'Driving Experience Japan',desc:'Access to : Limiter Remove,Upload Your Own Id Rims (Please join our server for guide before using)',img:'https://tr.rbxcdn.com/180DAY-369fb9270982d9db87cd14882e7adf8e/150/150/Image/Webp/noFilter'},
{id:22,name:'Exclusive Car Rent',price:7500,category:'Driving Experience Japan',desc:'This Gamepass Will Give you Access To Rent Some Styled Cars.',img:'https://tr.rbxcdn.com/180DAY-b90ca5ee8b9b224dd54f30a7a0046c5f/150/150/Image/Webp/noFilter'},
{id:23,name:'2X Paycheck',price:40000,category:'Driving Experience Japan',desc:'own this gamepass will give you 2x paycheck every 10 minutes',img:'https://tr.rbxcdn.com/180DAY-66fc7d854aa4e789bc4f09c00d12d167/150/150/Image/Webp/noFilter'},
{id:24,name:'Luxury Cars',price:11500,category:'Driving Experience Japan',desc:'Elegant, exotic and premium. This pass will unlock you to all the luxury cars of the game. Drive around luxury cars in the game!.',img:'https://tr.rbxcdn.com/180DAY-24a149c0d3fd1ead872befb325dbb1d6/150/150/Image/Webp/noFilter'},
{id:25,name:'Rare Import Cars',price:19500,category:'Driving Experience Japan',desc:'Own Import Cars. This Pass will unlock you all Rare Imports Cars',img:'https://tr.rbxcdn.com/180DAY-e30b56071895c3ba97de7fd0a9a026c1/150/150/Image/Webp/noFilter'},
{id:26,name:'Unlimited Car Slot Garage',price:12500,category:'Driving Experience Japan',desc:'owning this gamepass will give you more slot garage',img:'https://tr.rbxcdn.com/180DAY-588b1ca94da8d16bcbdea62d023470de/150/150/Image/Webp/noFilter'},
{id:27,name:'Retro Cars',price:12000,category:'Driving Experience Japan',desc:'Legend and nostalgic. This pass will unlock you to all retro cars of the game.',img:'https://tr.rbxcdn.com/180DAY-cab0a96228a73d3ce01ad41dcae39365/150/150/Image/Webp/noFilter'},
{id:28,name:'Sports Car',price:23500,category:'Driving Experience Japan',desc:'By owning performance cars. this pass will unlock you sport cars.',img:'https://tr.rbxcdn.com/180DAY-81e40df3485864aba6d8b6c3c6a3338c/150/150/Image/Webp/noFilter'},
];

  const CART_KEY = 'uds_cart_v1';
  let state = { cat: 'All', maxPrice: 150000, query: '', sort: 'relevance', cart: [] };

  // Nomor WhatsApp penjual (didefinisikan di satu tempat)
  const SELLER_WA_NUMBER = '6285183283404';

  const $ = s => document.querySelector(s);
  const catalog = $('#catalog');
  const productCount = $('#productCount');
  const categoryList = $('#categoryList');
  const priceRange = $('#priceRange');
  const priceRangeVal = $('#priceRangeVal');
  const searchInput = $('#searchInput');
  const cartCount = $('#cartCount');
  const cartSidebar = $('#cartSidebar');
  const cartItemsEl = $('#cartItems');
  const cartTotalEl = $('#cartTotal');
  const cartBar = $('#cartBar');
  const cartBadge = $('#cartBadge');
  const modalOverlay = $('#modalOverlay');
  const modalTitle = $('#modalTitle');
  const modalThumb = $('#modalThumb');
  const modalName = $('#modalName');
  const modalPrice = $('#modalPrice');
  const modalDesc = $('#modalDesc');
  const modalCategory = $('#modalCategory');
  const modalQuantity = $('#modalQuantity');
  const modalAdd = $('#modalAdd');
  const closeModalBtn = $('#closeModal');
  const mobileFilterBtn = $('#openFilter');
  const filterDrawer = $('#filterDrawer');
  const closeFilter = $('#closeFilter');
  const mobileCategoryList = $('#mobileCategoryList');
  const priceRangeMobile = $('#priceRangeMobile');
  const priceRangeValMobile = $('#priceRangeValMobile');
  const applyFilterMobile = $('#applyFilterMobile');
  const resetFilterMobile = $('#resetFilterMobile');
  const sortSelect = $('#sortSelect');
  const btnShopNow = $('#btnShopNow');
  const btnHow = $('#btnHow');
  const btnCartSmall = $('#btnCartSmall');
  const btnClearCart = $('#btnClearCart');
  const btnCheckout = $('#btnCheckout'); // Tombol checkout di sidebar keranjang

  // Elemen-elemen untuk Checkout Modal
  const checkoutModal = document.getElementById('checkoutModal');
  const checkoutCancel = document.getElementById('checkoutCancel');
  const checkoutSubmit = document.getElementById('checkoutSubmit');
  const checkoutUsernameInput = document.getElementById('checkoutUsername');
  const checkoutPhoneInput = document.getElementById('checkoutPhone');
  const checkoutPaymentSelect = document.getElementById('checkoutPayment');
  const checkoutNoteInput = document.getElementById('checkoutNote');
  const subtotalDisplay = document.getElementById('subtotalDisplay');
  const adminFeeDisplay = document.getElementById('adminFeeDisplay');
  const totalDisplay = document.getElementById('totalDisplay');

  // Pesan Error
  const errUsername = document.getElementById('errUsername');
  const errPhone = document.getElementById('errPhone');
  const errPayment = document.getElementById('errPayment');


  try { const saved = localStorage.getItem(CART_KEY); state.cart = saved ? JSON.parse(saved) : []; } catch(e){ state.cart = []; }

  function saveCart(){ try{ localStorage.setItem(CART_KEY, JSON.stringify(state.cart)); }catch(e){} }
  function debounce(fn, ms=300){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(this,a), ms); }; }
  function sumQty(){ return state.cart.reduce((s,c)=>s + (c.qty||0), 0); }

  function renderCategories(){
    if(!categoryList) return;
    const cats = ['All', ...Array.from(new Set(PRODUCTS.map(p=>p.category)))];
    categoryList.innerHTML = '';
    if(mobileCategoryList) mobileCategoryList.innerHTML = '';
    cats.forEach(c=>{
      const el = document.createElement('div');
      el.className = 'category' + (state.cat===c ? ' active' : '');
      el.tabIndex = 0; el.textContent = c;
      el.addEventListener('click', ()=>{ state.cat = c; document.querySelectorAll('.category').forEach(x=>x.classList.remove('active')); el.classList.add('active'); renderCatalog(); });
      categoryList.appendChild(el);
      if(mobileCategoryList){
        const mel = el.cloneNode(true);
        mel.addEventListener('click', ()=>{ state.cat = c; closeFilterDrawer(); renderCatalog(); });
        mobileCategoryList.appendChild(mel);
      }
    });
  }

  function renderCatalog(){
    if(!catalog) return;
    let items = PRODUCTS.slice();
    items = items.filter(p => p.price <= (state.maxPrice || 99999999));
    if(state.cat && state.cat !== 'All') items = items.filter(p => p.category === state.cat);
    if(state.query){ const q = state.query.toLowerCase(); items = items.filter(p => (p.name + ' ' + (p.desc||'') + ' ' + (p.category||'')).toLowerCase().includes(q)); }
    if(state.sort === 'price_asc') items.sort((a,b)=>a.price-b.price);
    if(state.sort === 'price_desc') items.sort((a,b)=>b.price-a.price);

    catalog.innerHTML = '';
    items.forEach(p=>{
      const card = document.createElement('div'); card.className = 'product';
      const thumb = document.createElement('div'); thumb.className='thumb';
      if(p.img){ thumb.style.backgroundImage = `url('${p.img}')`; } else { thumb.style.background = 'linear-gradient(135deg,#ffcc00,#ff8a00)'; thumb.textContent='🚗'; thumb.style.display='flex'; thumb.style.alignItems='center'; thumb.style.justifyContent='center'; thumb.style.fontSize='32px'; }
      card.appendChild(thumb);

      const body = document.createElement('div'); body.className = 'body';
      const h4 = document.createElement('h4'); h4.textContent = p.name; body.appendChild(h4);
      const pEl = document.createElement('p'); pEl.textContent = p.desc || ''; body.appendChild(pEl);
      const priceRow = document.createElement('div'); priceRow.className = 'price-row';
      const price = document.createElement('div'); price.className='price'; price.textContent = 'Rp' + p.price.toLocaleString('id-ID');
      const addWrap = document.createElement('div');
      const btn = document.createElement('button'); btn.className='add'; btn.textContent='Tambah'; btn.setAttribute('data-id', p.id);
      // Pastikan event listener ini memanggil openModal dengan produk yang benar
      btn.addEventListener('click', (event) => {
          event.stopPropagation(); // Mencegah event menyebar ke elemen lain jika ada
          openModal(p);
      });
      addWrap.appendChild(btn);
      priceRow.appendChild(price); priceRow.appendChild(addWrap);
      body.appendChild(priceRow);
      card.appendChild(body);
      catalog.appendChild(card);
    });
    if(productCount) productCount.textContent = items.length;
  }

  let currentModalProduct = null;
  function openModal(product){
    if(!modalOverlay) return;
    currentModalProduct = product; // Pastikan produk disimpan di sini
    console.log('Opening modal for product:', currentModalProduct); // Debugging
    if(modalTitle) modalTitle.textContent = product.name;
    if(modalThumb){
        if(product.img) modalThumb.style.backgroundImage = `url('${product.img}')`;
        else {
            modalThumb.style.background = 'linear-gradient(135deg,#ffcc00,#ff8a00)';
            modalThumb.textContent='🚗';
            modalThumb.style.display='flex';
            modalThumb.style.alignItems='center';
            modalThumb.style.justifyContent='center';
            modalThumb.style.fontSize='32px';
        }
        modalThumb.setAttribute('aria-label', product.alt || product.name);
    }
    if(modalName) modalName.textContent = product.name;
    if(modalPrice) modalPrice.textContent = 'Rp' + product.price.toLocaleString('id-ID');
    if(modalDesc) modalDesc.textContent = product.desc || '';
    if(modalCategory) modalCategory.textContent = product.category || '';
    if(modalQuantity) modalQuantity.value = 1; // Reset quantity to 1
    modalOverlay.style.display = 'flex';
  }
  function closeModal(){ if(modalOverlay) modalOverlay.style.display = 'none'; currentModalProduct = null; }

  function renderCart(){
    if(!cartItemsEl) return;
    cartItemsEl.innerHTML = '';
    if(!state.cart || state.cart.length === 0){ cartItemsEl.innerHTML = '<div style="color:var(--muted);padding:12px">Keranjang kosong</div>'; }
    state.cart.forEach(item => {
      const p = PRODUCTS.find(x=>x.id === item.id);
      if(!p) return;
      const el = document.createElement('div'); el.className = 'cart-item';
      const imgSrc = p.img ? p.img : '/assets/fallback.jpg';
      el.innerHTML = '<img src="' + imgSrc + '" alt="' + (p.alt||'') + '" onerror="this.src=\'/assets/fallback.jpg\'"/>' +
                     '<div style="flex:1"><div style="font-weight:700">' + p.name + '</div><div style="color:var(--muted);font-size:13px">Rp' + p.price.toLocaleString('id-ID') + ' x ' + item.qty + '</div></div>' +
                     '<div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end"><button class="icon-btn" data-action="inc" data-id="' + item.id + '" aria-label="Tambah jumlah">+</button><button class="icon-btn" data-action="dec" data-id="' + item.id + '" aria-label="Kurangi jumlah">-</button></div>';
      cartItemsEl.appendChild(el);
    });
    cartItemsEl.querySelectorAll('button').forEach(btn=>{ btn.addEventListener('click', ()=>{ const id = Number(btn.getAttribute('data-id')); const action = btn.getAttribute('data-action'); if(action==='inc') changeQty(id,1); else changeQty(id,-1); }); });
    const total = state.cart.reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + (p ? p.price * i.qty : 0); }, 0);
    if(cartTotalEl) cartTotalEl.textContent = 'Rp' + total.toLocaleString('id-ID');
    const qtySum = sumQty();
    if(cartCount) cartCount.textContent = qtySum;
    if(cartBadge) cartBadge.textContent = qtySum;
    saveCart();
  }

  function changeQty(id,delta){ const idx = state.cart.findIndex(c=>c.id === id); if(idx === -1) return; state.cart[idx].qty += delta; if(state.cart[idx].qty <= 0) state.cart.splice(idx,1); renderCart(); }
  function addToCart(product, qty=1){
      console.log('Adding to cart:', product, 'Quantity:', qty); // Debugging
      if (!product || !product.id) {
          console.error('Product is invalid or missing ID:', product);
          showFeedback('Gagal menambahkan produk. Produk tidak valid.');
          return;
      }
      const exists = state.cart.find(c=>c.id === product.id);
      if(exists) {
          exists.qty += qty;
      } else {
          state.cart.push({ id: product.id, qty });
      }
      renderCart();
      closeModal();
      showFeedback('Berhasil ditambahkan ke keranjang!');
  }

  function toggleCart(){ if(!cartSidebar) return; if(cartSidebar.style.display === 'block'){ cartSidebar.style.display = 'none'; cartSidebar.setAttribute('aria-hidden','true'); } else { cartSidebar.style.display = 'block'; cartSidebar.setAttribute('aria-hidden','false'); } }
  function clearCart(){ if(confirm('Kosongkan keranjang?')){ state.cart = []; renderCart(); showFeedback('Keranjang dikosongkan.'); } }
  function showFeedback(msg){ const el = document.createElement('div'); el.style.position='fixed'; el.style.right='18px'; el.style.bottom='90px'; el.style.background='var(--success)'; el.style.color='#000'; el.style.padding='10px 14px'; el.style.borderRadius='10px'; el.style.fontWeight='700'; el.style.zIndex='9999'; el.textContent = msg; document.body.appendChild(el); setTimeout(()=>el.remove(),1400); }

  function startTestimonialSlider(){ /* Dihapus karena bagian testimoni diganti */ } // Fungsi ini tidak lagi diperlukan
  function openFilterDrawer(){ if(!filterDrawer) return; filterDrawer.style.display='block'; filterDrawer.setAttribute('aria-hidden','false'); }
  function closeFilterDrawer(){ if(!filterDrawer) return; filterDrawer.style.display='none'; filterDrawer.setAttribute('aria-hidden','true'); }
  function showHow(){ const msg = 'Cara Order:\n1) Pilih produk.\n2) Tambah ke keranjang.\n3) Checkout via WhatsApp.\nPastikan kirim username & nomor WA yang benar.'; alert(msg); }

  // --- Fungsi untuk Checkout Modal ---
  function openCheckoutForm(){
    if(!checkoutModal) return;
    if(!state.cart || state.cart.length === 0){
        showFeedback('Keranjang Anda kosong. Silakan tambahkan produk terlebih dahulu.');
        return;
    }
    // Reset form dan pesan error setiap kali modal dibuka
    checkoutUsernameInput.value = '';
    checkoutPhoneInput.value = '';
    checkoutPaymentSelect.value = '';
    checkoutNoteInput.value = '';
    document.querySelectorAll('.error-msg').forEach(e => e.style.display = 'none');

    updateCheckoutTotals(); // Perbarui total saat modal dibuka
    checkoutModal.style.display = 'flex';
  }

  function closeCheckoutForm(){
    if(checkoutModal) checkoutModal.style.display = 'none';
  }

  function updateCheckoutTotals(){
    let subtotal = 0;
    state.cart.forEach(item=>{ // Mengakses state.cart yang benar
        const p = PRODUCTS.find(x=>x.id === item.id); // Mengakses PRODUCTS yang benar
        if(p) subtotal += p.price * item.qty;
    });

    let paymentMethod = checkoutPaymentSelect.value;
    let adminFee = 0;
    if(['Dana','OVO','GoPay'].includes(paymentMethod)) adminFee = 1000;
    else if(paymentMethod === 'QRIS') adminFee = 1500;
    else if(paymentMethod === 'Mandiri') adminFee = 2500;

    subtotalDisplay.textContent = 'Rp' + subtotal.toLocaleString('id-ID');
    adminFeeDisplay.textContent = 'Rp' + adminFee.toLocaleString('id-ID');
    totalDisplay.textContent = 'Rp' + (subtotal + adminFee).toLocaleString('id-ID');

    return {subtotal, adminFee, total: subtotal + adminFee};
  }

  function bindUI(){
    if(priceRange) priceRange.addEventListener('input', ()=>{ state.maxPrice = Number(priceRange.value); if(priceRangeVal) priceRangeVal.textContent = priceRange.value; renderCatalog(); });
    if(priceRangeMobile) priceRangeMobile.addEventListener('input', ()=>{ if(priceRangeValMobile) priceRangeValMobile.textContent = priceRangeMobile.value; });
    if(searchInput) searchInput.addEventListener('input', debounce((e)=>{ state.query = e.target.value.toLowerCase(); renderCatalog(); }, 300));
    if(btnShopNow) btnShopNow.addEventListener('click', ()=>{ const el = document.querySelector('.catalog'); if(el) window.scrollTo({ top: el.offsetTop - 80, behavior: 'smooth' }); });
    if(btnHow) btnHow.addEventListener('click', showHow);
    if(btnCartSmall) btnCartSmall.addEventListener('click', toggleCart);
    if(cartBar) cartBar.addEventListener('click', toggleCart);
    if(btnClearCart) btnClearCart.addEventListener('click', clearCart);

    // Mengganti event listener btnCheckout lama dengan yang baru untuk membuka modal
    if(btnCheckout) {
        // btnCheckout.removeEventListener('click', checkoutWhatsApp); // Hapus listener lama jika ada
        btnCheckout.addEventListener('click', openCheckoutForm);
    }

    if(sortSelect) sortSelect.addEventListener('change', (e)=>{ state.sort = e.target.value; renderCatalog(); });
    if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
    // Pastikan modalAdd terhubung dengan benar dan memanggil addToCart
    if(modalAdd) {
        modalAdd.addEventListener('click', ()=>{
            if(currentModalProduct) {
                const qty = Number(modalQuantity.value || 1);
                if (qty > 0) {
                    addToCart(currentModalProduct, qty);
                } else {
                    showFeedback('Jumlah produk harus lebih dari 0.');
                }
            } else {
                console.error('currentModalProduct is null when trying to add to cart.');
                showFeedback('Terjadi kesalahan, produk tidak ditemukan.');
            }
        });
    }
    window.addEventListener('click', (e)=>{ if(e.target === modalOverlay) closeModal(); });
    if(mobileFilterBtn) mobileFilterBtn.addEventListener('click', openFilterDrawer);
    if(closeFilter) closeFilter.addEventListener('click', closeFilterDrawer); // Perbaikan: closeFilterDrawer()
    if(applyFilterMobile) applyFilterMobile.addEventListener('click', ()=>{ state.maxPrice = Number(priceRangeMobile.value); if(priceRange) priceRange.value = priceRangeMobile.value; if(priceRangeVal) priceRangeVal.textContent = priceRangeMobile.value; closeFilterDrawer(); renderCatalog(); });
    if(resetFilterMobile) resetFilterMobile.addEventListener('click', ()=>{ if(priceRangeMobile) priceRangeMobile.value = 100000; if(priceRangeValMobile) priceRangeValMobile.textContent = '100000'; });
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape'){ closeModal(); closeFilterDrawer(); closeCheckoutForm(); } }); // Tambah closeCheckoutForm

    // Event listeners untuk Checkout Modal
    if(checkoutCancel) checkoutCancel.addEventListener('click', closeCheckoutForm);
    window.addEventListener('click', function(e){ // Tutup modal jika klik di luar
        if(e.target === checkoutModal){
            closeCheckoutForm();
        }
    });

    // Update total saat metode pembayaran berubah
    if(checkoutPaymentSelect) checkoutPaymentSelect.addEventListener('change', updateCheckoutTotals);

    // Reset pesan error saat input berubah
    if(checkoutUsernameInput) checkoutUsernameInput.addEventListener('input', () => { errUsername.style.display = 'none'; });
    if(checkoutPhoneInput) checkoutPhoneInput.addEventListener('input', () => { errPhone.style.display = 'none'; });
    if(checkoutPaymentSelect) checkoutPaymentSelect.addEventListener('change', () => { errPayment.style.display = 'none'; });


    // Submit handler untuk Checkout Modal
    if(checkoutSubmit){
        checkoutSubmit.addEventListener('click', function(){
            const username = checkoutUsernameInput.value.trim();
            const phone = checkoutPhoneInput.value.trim();
            const payment = checkoutPaymentSelect.value.trim();
            const note = checkoutNoteInput.value.trim();

            // Reset errors
            document.querySelectorAll('.error-msg').forEach(e => e.style.display = 'none');
            let valid = true;

            if(!username){
                errUsername.style.display = 'block';
                valid = false;
            }
            // Validasi nomor WhatsApp dengan regex
            const phoneRegex = /^(08|\+628)[0-9]{7,11}$/; // Contoh regex untuk nomor Indonesia
            if(!phone || !phoneRegex.test(phone)){
                errPhone.textContent = 'Harap isi Nomor WhatsApp yang valid (cth: 081234567890)';
                errPhone.style.display = 'block';
                valid = false;
            }
            if(!payment){
                errPayment.style.display = 'block';
                valid = false;
            }

            if(!valid) return; // Hentikan jika ada validasi yang gagal

            if(!state.cart || state.cart.length === 0){
                showFeedback('Keranjang kosong. Tidak dapat melanjutkan checkout.');
                closeCheckoutForm();
                return;
            }

            const totals = updateCheckoutTotals();
            const bold = txt => `*${txt}*`;

            let firstItem = state.cart.length > 0 ? PRODUCTS.find(p => p.id === state.cart[0].id) : null;
let productLine = firstItem ? `${bold(firstItem.name)} - Rp${firstItem.price.toLocaleString('id-ID')}` : '';

let orderText = `PESANAN MASUK ${productLine}\n` +
`Username Roblox: ${username}\n` +
`Metode Pembayaran: ${payment}\n` +
`Total: Rp${totals.total.toLocaleString('id-ID')} (termasuk biaya admin Rp${totals.adminFee.toLocaleString('id-ID')})\n` +
`Nomor WhatsApp: ${phone}\n` +
`Catatan: ${note || ''}`;

const waUrl = 'https://wa.me/' + SELLER_WA_NUMBER + '?text=' + encodeURIComponent(orderText);
window.open(waUrl, '_blank');

            closeCheckoutForm();
            clearCart(); // Kosongkan keranjang setelah pesanan dikirim
            showFeedback('Pesanan Anda telah dikirim!');
        });
    }
  }

  function init(){
    renderCategories();
    renderCatalog();
    bindUI();
    renderCart();
    // startTestimonialSlider(); // Dihapus karena bagian testimoni diganti
  }
  init();

  // Ekspos PRODUCTS dan state ke global window._UDS agar bisa diakses oleh fungsi lain jika diperlukan
  window._UDS = { PRODUCTS, state, renderCatalog, renderCart, addToCart, openModal, updateCheckoutTotals };
})();
</script>
</body>
</html>
